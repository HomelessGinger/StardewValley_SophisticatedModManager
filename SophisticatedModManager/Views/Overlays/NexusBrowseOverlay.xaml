<UserControl x:Class="SophisticatedModManager.Views.Overlays.NexusBrowseOverlay"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:SophisticatedModManager.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=vm:MainViewModel}">
    <Border Background="{StaticResource ContentBgBrush}" Padding="30,20">
        <DockPanel>
            <!-- Header -->
            <Grid DockPanel.Dock="Top" Margin="0,0,0,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="Browse Nexus Mods"
                           FontSize="20" FontWeight="Bold"
                           Foreground="{StaticResource WoodBrownBrush}"
                           VerticalAlignment="Center"/>
                <Button Grid.Column="1" Content="Close"
                        Style="{StaticResource StardewButton}"
                        Command="{Binding CloseBrowseNexusCommand}"
                        Padding="10,4" FontSize="11"/>
            </Grid>

            <!-- Install from URL -->
            <Border DockPanel.Dock="Top"
                    Background="{StaticResource CardBgBrush}"
                    BorderBrush="{StaticResource CardBorderBrush}"
                    BorderThickness="1" CornerRadius="4"
                    Padding="12,8" Margin="0,0,0,12">
                <StackPanel>
                    <TextBlock Text="Install from Nexus URL or Mod ID"
                               FontSize="13" FontWeight="SemiBold"
                               Foreground="{StaticResource DarkEarthBrush}"
                               Margin="0,0,0,6"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0"
                                 Style="{StaticResource StardewTextBox}"
                                 Text="{Binding NexusInstallUrl, UpdateSourceTrigger=PropertyChanged}"
                                 FontSize="12"/>
                        <Button Grid.Column="1"
                                Style="{StaticResource StardewButton}"
                                Command="{Binding InstallFromNexusUrlCommand}"
                                Margin="8,0,0,0" Padding="10,4" FontSize="11">
                            <Button.Content>
                                <TextBlock>
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="Install"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsInstallingFromNexus}" Value="True">
                                                    <Setter Property="Text" Value="Installing..."/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </Button.Content>
                        </Button>
                    </Grid>
                    <TextBlock Text="{Binding NexusInstallStatus}"
                               FontSize="11" Foreground="{StaticResource SubtleTextBrush}"
                               Margin="0,4,0,0"/>
                </StackPanel>
            </Border>

            <!-- Install to active profile checkbox -->
            <CheckBox DockPanel.Dock="Top"
                      Style="{StaticResource StardewCheckBox}"
                      IsChecked="{Binding NexusInstallToActiveProfile}"
                      Margin="0,0,0,8">
                <TextBlock Text="Install mods to active profile"
                           FontSize="12"
                           Foreground="{StaticResource DarkEarthBrush}"
                           Margin="6,0,0,0"
                           VerticalAlignment="Center"/>
            </CheckBox>

            <!-- Category tabs -->
            <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,12">
                <Button Content="Trending"
                        Style="{StaticResource StardewButton}"
                        Command="{Binding SwitchNexusBrowseCategoryCommand}"
                        CommandParameter="Trending"
                        Padding="10,4" FontSize="11" Margin="0,0,6,0"/>
                <Button Content="New"
                        Style="{StaticResource StardewButton}"
                        Command="{Binding SwitchNexusBrowseCategoryCommand}"
                        CommandParameter="New"
                        Padding="10,4" FontSize="11" Margin="0,0,6,0"/>
                <Button Content="Recently Updated"
                        Style="{StaticResource StardewButton}"
                        Command="{Binding SwitchNexusBrowseCategoryCommand}"
                        CommandParameter="Recently Updated"
                        Padding="10,4" FontSize="11" Margin="0,0,6,0"/>
                <TextBlock Text="{Binding NexusBrowseCategory, StringFormat='Showing: {0}'}"
                           FontSize="12" Foreground="{StaticResource SubtleTextBrush}"
                           VerticalAlignment="Center" Margin="8,0,0,0"/>
            </StackPanel>

            <!-- Loading indicator -->
            <TextBlock DockPanel.Dock="Top"
                       Text="Loading..."
                       FontSize="13" FontStyle="Italic" Foreground="{StaticResource SubtleTextBrush}"
                       Visibility="{Binding IsNexusBrowseLoading, Converter={StaticResource BoolToVis}}"
                       Margin="0,0,0,8"/>

            <!-- Results -->
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel>
                <ItemsControl ItemsSource="{Binding NexusBrowseResults}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type vm:NexusBrowseItem}">
                            <Border Background="{StaticResource CardBgBrush}"
                                    BorderBrush="{StaticResource CardBorderBrush}"
                                    BorderThickness="1" CornerRadius="4"
                                    Padding="12,8" Margin="0,0,0,6">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Image Grid.Column="0" Width="60" Height="60"
                                           Stretch="UniformToFill" Margin="0,0,10,0"
                                           VerticalAlignment="Center"
                                           Source="{Binding PictureUrl, IsAsync=True, TargetNullValue={x:Null}}"/>
                                    <StackPanel Grid.Column="1">
                                        <StackPanel Orientation="Horizontal">
                                            <Button Cursor="Hand"
                                                    Command="{Binding DataContext.ViewModDetailCommand,
                                                        RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <TextBlock Text="{Binding Name}"
                                                                   FontWeight="SemiBold" FontSize="13"
                                                                   Foreground="{StaticResource DarkEarthBrush}"
                                                                   TextDecorations="Underline"/>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>
                                            <TextBlock Text="{Binding Version, StringFormat=' v{0}'}"
                                                       FontSize="11" Foreground="{StaticResource SubtleTextBrush}"
                                                       VerticalAlignment="Center" Margin="6,0,0,0"/>
                                        </StackPanel>
                                        <TextBlock FontSize="11" Foreground="{StaticResource SubtleTextBrush}">
                                            <Run Text="by "/>
                                            <Run Text="{Binding Author, Mode=OneWay}"/>
                                        </TextBlock>
                                        <TextBlock Text="{Binding Summary}"
                                                   FontSize="11" Foreground="{StaticResource MutedTextBrush}"
                                                   TextWrapping="Wrap" TextTrimming="CharacterEllipsis"
                                                   MaxHeight="34" Margin="0,2,0,0"/>
                                    </StackPanel>
                                    <Button Grid.Column="2"
                                            Style="{StaticResource StardewButton}"
                                            Command="{Binding DataContext.InstallNexusBrowseItemCommand,
                                                RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"
                                            Padding="10,4" FontSize="11"
                                            VerticalAlignment="Center" Margin="8,0,0,0">
                                        <Button.Content>
                                            <TextBlock>
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Text" Value="Install"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsInstalling}" Value="True">
                                                                <Setter Property="Text" Value="..."/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Button.Content>
                                    </Button>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Load More button -->
                <Button Content="Load More"
                        Style="{StaticResource StardewButton}"
                        Command="{Binding LoadMoreNexusModsCommand}"
                        Visibility="{Binding CanLoadMoreNexus, Converter={StaticResource BoolToVis}}"
                        HorizontalAlignment="Center" Margin="0,8"
                        Padding="20,6" FontSize="12"/>
                </StackPanel>
            </ScrollViewer>
        </DockPanel>
    </Border>
</UserControl>
