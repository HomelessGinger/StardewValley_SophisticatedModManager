<UserControl x:Class="SophisticatedModManager.Views.Overlays.ModDetailOverlay"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:SophisticatedModManager.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=vm:MainViewModel}">
    <Border Background="{StaticResource OverlayDarkDimBrush}"
            HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
        <Border Background="{StaticResource ContentBgBrush}"
                BorderBrush="{StaticResource WoodBrownBrush}"
                BorderThickness="2" CornerRadius="6"
                Padding="24,20"
                HorizontalAlignment="Center" VerticalAlignment="Center"
                MinWidth="500" MaxWidth="650" MaxHeight="500">
            <DockPanel>
                <!-- Header with close button -->
                <Grid DockPanel.Dock="Top" Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Button Grid.Column="1" Content="Close"
                            Style="{StaticResource StardewButton}"
                            Command="{Binding CloseModDetailCommand}"
                            Padding="10,4" FontSize="11"/>
                </Grid>

                <!-- Mod info header -->
                <Grid DockPanel.Dock="Top" Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Image Grid.Column="0" Width="120" Height="120"
                           Stretch="UniformToFill" Margin="0,0,16,0"
                           VerticalAlignment="Top"
                           Source="{Binding ModDetailItem.PictureUrl, IsAsync=True, TargetNullValue={x:Null}}"/>
                    <StackPanel Grid.Column="1" VerticalAlignment="Top">
                        <TextBlock Text="{Binding ModDetailItem.Name}"
                                   FontSize="18" FontWeight="Bold"
                                   Foreground="{StaticResource DarkEarthBrush}"
                                   TextWrapping="Wrap"/>
                        <TextBlock FontSize="12" Foreground="{StaticResource SubtleTextBrush}" Margin="0,4,0,0">
                            <Run Text="{Binding ModDetailItem.Version, StringFormat='v{0}', Mode=OneWay}"/>
                            <Run Text=" by "/>
                            <Run Text="{Binding ModDetailItem.Author, Mode=OneWay}"/>
                        </TextBlock>
                        <TextBlock Text="{Binding ModDetailDescription}"
                                   FontSize="12" Foreground="{StaticResource MutedTextBrush}"
                                   TextWrapping="Wrap" Margin="0,8,0,0"
                                   MaxHeight="60" TextTrimming="CharacterEllipsis"/>
                        <Button Cursor="Hand" Margin="0,8,0,0" HorizontalAlignment="Left"
                                Command="{Binding OpenModInBrowserCommand}"
                                CommandParameter="{Binding ModDetailItem}">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <TextBlock Text="Open on Nexus Mods"
                                               FontSize="11" Foreground="{StaticResource LeafGreenBrush}"
                                               TextDecorations="Underline"/>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </StackPanel>
                </Grid>

                <!-- Loading -->
                <TextBlock DockPanel.Dock="Top"
                           Text="Loading files..."
                           FontSize="12" FontStyle="Italic" Foreground="{StaticResource SubtleTextBrush}"
                           Visibility="{Binding IsLoadingModDetail, Converter={StaticResource BoolToVis}}"
                           Margin="0,0,0,8"/>

                <!-- Files section header -->
                <TextBlock DockPanel.Dock="Top"
                           Text="Available Files"
                           FontSize="14" FontWeight="SemiBold"
                           Foreground="{StaticResource WoodBrownBrush}"
                           Margin="0,0,0,6"/>

                <!-- Files list -->
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding ModDetailFiles}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{StaticResource CardBgBrush}"
                                        BorderBrush="{StaticResource CardBorderBrush}"
                                        BorderThickness="1" CornerRadius="3"
                                        Padding="10,6" Margin="0,0,0,4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding Name}"
                                                       FontWeight="SemiBold" FontSize="12"
                                                       Foreground="{StaticResource DarkEarthBrush}"
                                                       TextTrimming="CharacterEllipsis"/>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Version, StringFormat='v{0}'}"
                                                           FontSize="10" Foreground="{StaticResource SubtleTextBrush}"/>
                                                <TextBlock Text="{Binding CategoryName, StringFormat=' â€” {0}'}"
                                                           FontSize="10" Foreground="{StaticResource MutedTextBrush}"/>
                                                <TextBlock Text="{Binding SizeKb, StringFormat=' ({0:N0} KB)'}"
                                                           FontSize="10" Foreground="{StaticResource MutedTextBrush}"/>
                                            </StackPanel>
                                        </StackPanel>
                                        <Button Grid.Column="2"
                                                Content="Install"
                                                Style="{StaticResource StardewButton}"
                                                Command="{Binding DataContext.InstallModFileCommand,
                                                    RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                Padding="10,3" FontSize="11"
                                                VerticalAlignment="Center" Margin="8,0,0,0"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </DockPanel>
        </Border>
    </Border>
</UserControl>
